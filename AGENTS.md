# AGENTS.md — Guidance for AI Coding Agents

This repository is an **R package**: **mispitools** (“Missing Person Identification Tools”).
Agents working here should optimize for: **Reproducibility, CRAN-friendly practices, and documentation quality**.

---

## 1) Project context

**mispitools** supports missing person identification / kinship inference workflows, including:
- Simulation-based decision support
- Likelihood ratios (LRs) from **genetic evidence** and **non-genetic / preliminary investigative evidence** (sex, age, pigmentation traits, etc.)
- Plotting and decision-threshold utilities
- A Shiny app for interactive exploration

**Domain note:** outputs may be used in forensic/investigative contexts. Be conservative, explicit about assumptions, and avoid overstating conclusions.

---

## 2) Repository map

- `R/` — package source (functions, helpers, Shiny app code)
- `man/` — autogenerated `.Rd` docs (via roxygen2)
- `NAMESPACE` — generated by roxygen2
- `DESCRIPTION` — dependencies/metadata
- `README.md` / `README.Rmd` — overview and examples
- `data/` — packaged datasets (if any)
- `inst/` — auxiliary files bundled with the package (if any)
- `Toys/` — experimental/toy examples (not necessarily CRAN-grade)

**Rule:** do not edit `man/` or `NAMESPACE` manually. Update roxygen in `R/` and regenerate docs.

---

## 3) Local development

### Requirements
- R (and optionally RStudio)
- Recommended packages: `devtools`, `roxygen2`, `testthat` (if/when tests exist)

### Install dependencies and load package (fast dev loop)
In an R session:

```r
install.packages(c("devtools", "roxygen2"))
devtools::install_deps(dependencies = TRUE)
devtools::load_all()
```

### Regenerate documentation
```r
devtools::document()
```

### Run checks before any PR
```r
devtools::check()
# More strict (CRAN-like) from shell:
# R CMD check --as-cran .
```

**Performance guideline:** examples and checks must be fast and deterministic. For simulations, keep defaults small and document how to run larger experiments.

---

## 4) Coding standards & conventions

### 4.1 Style
- Use **2 spaces** indentation.
- Prefer `<-` for assignment in package code (examples may vary, but be consistent).
- Keep functions small, composable, and documented.
- Avoid large formatting-only changes unless requested.

### 4.2 Reproducibility (critical)
- Simulation functions should accept a `seed` parameter (or accept an RNG state) whenever practical.
- Do not change RNG behavior without:
  1) documenting it,
  2) updating examples/tests (if any),
  3) noting potential downstream impact.

### 4.3 Naming conventions (reviewer-sensitive area)
Current codebase may mix camelCase, underscores, and abbreviations. To avoid breaking users:
- **Do not rename exported functions casually.**
- If you must rename an exported function:
  - keep the old name as an alias, and
  - document deprecation (what to use instead; since when).
- New exported functions should follow the dominant public API style in the surrounding module.
- Avoid confusing near-duplicates (e.g., `LRcols` vs `LRcolors`-type mistakes).
- Prefer names that reflect what the function actually does (e.g., “plot/estimate/simulate” vs “compute” if it mainly visualizes).

### 4.4 Data vs functions (clarity)
Be explicit whether an object is a **dataset** or a **function**:
- Datasets:
  - use roxygen `@docType data` and export as objects (no parentheses)
  - document source, population/markers (for allele frequency DBs), and references
- Functions:
  - must have `@param`, `@return`, and runnable `@examples`

---

## 5) Documentation standards (high priority)

### 5.1 Roxygen2 requirements
Every exported function must include:
- Title (one sentence)
- Description with assumptions/limitations
- Parameter docs (types, meaning, allowed ranges)
- Return value docs
- Minimal runnable example

### 5.2 Examples & vignettes
- Add informative examples where reviewers requested clarity:
  - combined pigmentation features (hair/eye/skin) in one workflow
  - consistent person highlighting across pedigrees/plots (e.g., “color person 7 red in both pedigrees”)
- Prefer a vignette in `vignettes/` for end-to-end workflows and “real-world-ish” public data examples.

### 5.3 Statistical clarity (avoid common pitfalls)
When documenting error rates / classifier performance:
- Distinguish:
  - theoretical quantities (e.g., `P(LR > t | H1)`)
  - Monte Carlo estimates from simulations
- State conditioning and hypotheses clearly (H1 vs H0) and what is simulated under each.

### 5.4 Imported vs novel functionality
If key computations rely on other CRAN packages (pedigree structures, genetic simulations, likelihoods):
- document what is imported/assumed vs what is newly implemented here
- add references where appropriate

---

## 6) Shiny app guidelines (if modifying the app)
- Ensure UI readability on laptops:
  - avoid tiny labels for epsilon/arrow annotations
  - prefer clearer spacing and consistent font sizing
- Heavy computations should:
  - be explicitly user-triggered (buttons), and/or
  - show progress indicators
- Keep app changes isolated from core statistical routines unless necessary.

---

## 7) Safety, privacy, and data handling
- Do **not** add real person data to the repository.
- Use simulated or publicly available datasets only.
- Avoid claims that the software “identifies a person”; it provides statistical support under stated assumptions.
- Never commit secrets (tokens/keys); use env vars and standard R patterns.

---

## 8) Agent “Definition of Done” (PR checklist)

Before opening a PR, ensure:
- [ ] `devtools::document()` run; generated files updated accordingly
- [ ] `devtools::check()` passes locally (or failures explained and scoped)
- [ ] New/changed exports have roxygen docs + runnable examples
- [ ] Naming is consistent or backward-compatible (no silent breaks)
- [ ] Any warnings in examples are resolved or justified
- [ ] README/vignette updated if user-facing behavior changed

---

## 9) Review-driven improvement backlog

When choosing tasks, prioritize:
1. Documentation polish and expanded examples (potential vignette)
2. Clarify flexibility for **multiple pigmentation features** (hair/skin/eye) and show combined usage
3. Fix naming confusion and ensure docs match reality (e.g., `LRcols` vs `LRcolors()`, plot-vs-compute naming)
4. Improve Shiny UI readability (especially epsilon/arrow labels)
5. Clarify genetic LR assumptions and distinguish imported core functionality vs novel components
6. Clearly separate and document “data objects” vs “functions” consistently

---

## 10) Collaboration & PR communication norms

When making changes:
- Explain *what* changed, *why*, and *where* (file/function names).
- If a change affects scientific interpretation, add an “Assumptions” note to docs.
- Prefer incremental PRs focused on one theme (docs, naming, Shiny UI, etc.).

---

## 11) What an agent should NOT do
- Do not reformat the entire codebase in one PR.
- Do not rename exported functions without a compatibility plan.
- Do not introduce new heavyweight dependencies without justification.
- Do not add non-reproducible examples or long-running checks by default.

End of AGENTS.md
